# INSTRUCTIONS FOR VPS AGENT (GHOST BOT V2.01 UPDATE)

The Android App (v2.01) now supports Dynamic Strategy Injection and Visual State Sync.
Please apply the following changes to the Bot's codebase on the VPS.

## 1. Update `mobile_link.py`
**Goal**: Allow the bot to upload its list of recipes to Firebase so the App can display them.

**Action**: Add the `broadcast_recipes` method to the `GhostUplink` class.

```python
    def broadcast_recipes(self, cookbook):
        """
        Uploads the full Recipe Manifest to Firebase for the Mobile App.
        Path: users/{bot_id}/system/recipes
        """
        try:
            self.ref_system = db.reference(f'users/{self.bot_id}/system/recipes')
            self.ref_system.set(cookbook)
            print(f"üìú MANIFEST: Uploaded {len(cookbook)} recipes to Cloud.")
        except Exception as e:
            print(f"‚ö†Ô∏è MANIFEST UPLOAD FAILED: {e}")
```

## 2. Update `dashboard.py`
**Goal**: Sync recipes on startup/change and handle "Remote Save" commands from the App.

**Action A**: Add `sync_recipes` method to `TradingOS` class.
```python
    def sync_recipes(self):
        """Push local cookbook to mobile app."""
        if hasattr(self, 'uplink') and self.uplink and hasattr(self, 'cookbook'):
            self.uplink.broadcast_recipes(self.cookbook)
            print("üì§ Recipes Synced to Mobile.")
```

**Action B**: Call `sync_recipes` in `start_trading_thread` (after history bootstrap).
```python
            # Initial History Sync
            self.executor.bootstrap_mobile_history(limit=30)
            # Initial Recipe Sync
            self.root.after(5000, self.sync_recipes)
```

**Action C**: Update `handle_remote_command` to handle `save_recipe`.
Add this block inside `handle_remote_command` (e.g., after the "Recipe Injection" block):

```python
            # 5. Recipe Save (Remote Editor)
            if "save_recipe" in data:
                try:
                    r_data = data["save_recipe"] # {name: "...", settings: {...}}
                    name = r_data.get("name")
                    settings = r_data.get("settings")
                    
                    if name and settings and hasattr(self, 'cookbook'):
                        # Update Cookbook
                        if name in self.cookbook:
                            self.cookbook[name].update(settings)
                        else:
                            self.cookbook[name] = settings # New Recipe
                        
                        # Persist to Disk
                        import recipes
                        recipes.save_recipes(self.cookbook)
                        
                        # Sync back to cloud (Confirm success)
                        self.sync_recipes()
                        
                        self.mobile_log(f"ÔøΩ REMOTE SAVE: Recipe '{name}' updated.")
                except Exception as e:
                     self.mobile_log(f"‚ùå SAVE ERROR: {e}")
```

## 3. Telemetry Verification
Ensure the `broadcast_vitals` method (in `dashboard.py`) includes these keys (The App expects them now):
- `swarm_mode` (Boolean)
- `use_firewall` (Boolean)
- `whale_tracker` (Boolean, maps to USE_SR_FILTER)
- `auto_rev` (Boolean)
- `risk_percent` (Float)

*End of Instructions*

## 4. [NEW] v2.06 Holiday Logic Sync
**Goal**: Ensure Mobile App detects "PAUSE" state during holidays.

**Action**: Verify `broadcast_vitals` in `dashboard.py`.
Ensure that `mode_name` accurately reflects the "PAUSE" state if the Scheduler or User sets it.

```python
    # In broadcast_vitals()
    # Ensure this logic exists or similar:
    mode_name = self.brain.config.get("MODE_NAME", "MANUAL")
    
    # If Scheduler says PAUSE, override:
    if self.scheduler.is_holiday(): # hypothetical check
         mode_name = "PAUSE"
    
    vitals = {
        "mode_name": mode_name,
        # ... other keys
    }
```
**CRITICAL**: The App looks for the string `"PAUSE"` (case-sensitive) to show the "Resume" UI.
