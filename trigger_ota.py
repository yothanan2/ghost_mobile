
import firebase_admin
from firebase_admin import credentials, db
import sys

# DATABASE URL (Europe West 1)
DB_URL = "https://ghost-app-2fff8-default-rtdb.europe-west1.firebasedatabase.app/"

def trigger_update():
    print("üöÄ OTA UPDATE TRIGGER: v4.02")
    
    # 1. Initialize Firebase
    try:
        cred = credentials.Certificate("serviceAccountKey.json")
        firebase_admin.initialize_app(cred, {'databaseURL': DB_URL})
        print("‚úÖ Firebase Connected")
    except Exception as e:
        print(f"‚ùå Connection Error: {e}")
        return

    # 2. Define Update Payload
    update_data = {
        "code": 46,
        "name": "4.03",
        "url": "https://github.com/yothanan2/ghost_mobile/releases/download/v4.03/Ghost_v4.03_Release.apk",
        "changelog": "üîπ PROTCOL 4.03: TACTICAL HEARTBEAT\n- Pulsing 'Glow' effect for active trades (Green/Red)\n- Removed redundant RSI/ADX indicators\n- Enhanced P/L visibility with T-PNL progress bars\n- Streamlined Idle states",
        "mandatory": False,
        "changelog_map": {
            "en": "üîπ TACTICAL HEARTBEAT\n- Active trades now pulse with glow based on P/L status.",
            "th": "üîπ ‡∏£‡∏∞‡∏ö‡∏ö TACTICAL HEARTBEAT\n- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÑ‡∏ü‡∏Å‡∏∞‡∏û‡∏£‡∏¥‡∏ö (Glow) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÅ‡∏î‡∏á/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)\n- ‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¥‡∏ô‡∏î‡∏¥‡πÄ‡∏Ñ‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß"
        },
        "timestamp": {".sv": "timestamp"}
    }

    # 3. Push to 'system/version' (Correct Path per MainActivity.kt)
    ref = db.reference('system/version')
    ref.set(update_data)
    
    print("\nüì° UPDATE SIGNAL SENT!")
    print(f"   Version: {update_data['name']} (Code {update_data['code']})")
    print(f"   URL: {update_data['url']}")
    print("   Users should see the popup immediately.")

if __name__ == "__main__":
    trigger_update()
